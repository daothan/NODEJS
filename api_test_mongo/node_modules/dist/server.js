'use strict';

var express = require('express');

var app = express();
var morgan = require('morgan');
var bodyParser = require('body-parser');

var port = process.env.PORT || 3000;
var book = require('./controllers/routes/book');

var connection = require('./controllers/model/connection');

if (process.env.PORT !== 'test') {
  app.use(morgan('combined'));
}

// Parse application/json and look for raw text
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.text());
app.use(bodyParser.json({ type: 'application/json' }));

app.get('/', function (req, res) {
  return res.json({ message: 'Welcome to Book list' });
});

// Routes all books
app.route('/books').get(book.getBooks).post(book.postBook);

// Routes book by Id
app.route('/books/:id').get(book.getBook).delete(book.deleteBook).put(book.updateBook);

app.get('/find', connection.find);

app.listen(port, function () {
  console.log('App is running');
});

// export all modules for testing
module.exports = app;